<!DOCTYPE html>
<meta charset="utf-8">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<style> /* set the CSS */

.co2line {
  fill: none;
  stroke: steelblue;
  stroke-width: 2px;
}

.axisSteelBlue text{
  fill: steelblue;
}

.axisRed text{
  fill: red;
}
  
.axisPurple text {
  fill: purple;
}

/* Create two unequal columns that floats next to each other */
.column {
  float: left;
  padding: 10px;
  height: 300px; /* Should be removed. Only for demonstration */
}

.left {
  width: 15%;
}

.right {
  width: 85%;
}

/* Clear floats after the columns */
.row:after {
  content: "";
  display: table;
  clear: both;
}

div.tooltip {	
    position: absolute;			
    text-align: center;			
    width: 180px;					
    height: 50px;					
    padding: 2px;				
    font: 18px sans-serif;		
    background: lightsteelblue;	
    border: 0px;		
    border-radius: 8px;			
    pointer-events: none;			
}
</style>
<body onload="onLoad()">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <!-- load the d3.js library -->    	
    <script src="https://d3js.org/d3.v5.min.js"></script>

    <h1>Climate Correlations to CO2 Concentration in Atmosphere</h1>
    
    <div class="row">
      <div class="column left">
        <button type="button" class="btn btn-primary">CO2 Concentration</button><br>
        <button type="button" class="btn btn-primary">US Average Temperature</button><br>
        <button type="button" class="btn btn-primary">US Average Precipitation</button>
      </div>
      <div class="column right">
        <svg></svg>
      </div>
<script>
async function onLoad(){
  // set the dimensions and margins of the graph
  var margin = {top: 10, right: 40, bottom: 30, left: 50},
      width  = 960 - margin.left - margin.right,
      height = 500 - margin.top - margin.bottom;

  // parse the date / time
  var parseTime = d3.timeParse("%Y%m");
  var formatTime = d3.timeFormat("%Y/%m");

  var data = await d3.csv("/data/all_data.csv").then(function(data){
    // console.log(data);
    return data;
  }).catch(function(){
    console.log("error loading file")
  });

  // axis
  var xScale  = d3.scaleTime()
            .domain([
              d3.min(data, function(d){return parseTime(d.YearMonth);}), 
              d3.max(data, function(d){return parseTime(d.YearMonth);})
            ])
            .range([0,width]);
  var y_pcpScale  = d3.scaleBand()
            .domain([0,5.5])
            .range([height,0]);
  var y_tavgScale  = d3.scaleBand()
            .domain([0,80])
            .range([height,0]);
  var y_co2Scale  = d3.scaleLinear()
            .domain([310,420])
            .range([height,0]);
  const marker = d3.line().x(d => xScale(parseTime(d.YearMonth))); //.y(d => y(d.population));

  var pcp_line = d3.line()
      .x(function(d) { return xScale(parseTime(d.YearMonth)); }) // set the x values for the line generator
      .y(function(d) { return y_pcpScale(d.PCP); }) // set the y values for the line generator 
      .curve(d3.curveMonotoneX); // apply smoothing to the line

  var tavg_line = d3.line()
      .x(function(d) { return xScale(parseTime(d.YearMonth)); }) // set the x values for the line generator
      .y(function(d) { return y_tavgScale(d.TAVG); }) // set the y values for the line generator 
      .curve(d3.curveMonotoneX); // apply smoothing to the line

  var co2_line = d3.line()
      .x(function(d) { return xScale(parseTime(d.YearMonth)); }) // set the x values for the line generator
      .y(function(d) { return y_co2Scale(d.CO2_average); }) // set the y values for the line generator 
      .curve(d3.curveMonotoneX); // apply smoothing to the line

  // mark tooltop and intersection line
  var tooltip = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);
  const tooltipLine = d3.select("body").append('line');

  var svg = d3.select('svg')
    .attr('width', width+margin.left+margin.right)
    .attr('height', height+margin.top+margin.bottom)
    .append('g')
      .attr('transform', 'translate('+margin.left+','+margin.top+')');

  // insert X axis
  svg.append('g')
    .attr('transform', 'translate('+0+','+(height+margin.top)+')')
    .attr("class", "x axis")
    .call(d3.axisBottom(xScale));

  // insert CO2 axis
  svg.append('g')
    .attr('transform', 'translate('+0+','+margin.top+')')
    .attr("class", "y axis")
    .call(d3.axisLeft(y_co2Scale));

  svg.append('path')
      .data([data])
      .attr('class', 'co2line')
      .attr('d', co2_line);

  svg.selectAll("dot")	
        .data(data)			
    .enter().append("circle")								
        .attr("r", 2)		
        .attr("cx", function(d) { return xScale(parseTime(d.YearMonth)); })		 
        .attr("cy", function(d) { return y_co2Scale(d.CO2_average); })
        .attr("fill", "steelblue")
        .on("mouseover", function(d) {		
              tooltip.transition()		
                .duration(200)		
                .style("opacity", .9);		
              tooltip.html("YearMonth: "+formatTime(parseTime(d.YearMonth)) + "<br/>CO2: "  + d.CO2_average + " ppm")	
                .style("left", (d3.event.pageX) + "px")		
                .style("top", (d3.event.pageY - 28) + "px");	
            })					
        .on("mouseout", function(d) {		
              tooltip.transition()		
                .duration(500)		
                .style("opacity", 0);	
        });
}
</script>
</body>
